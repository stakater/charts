apiVersion: v1
kind: ConfigMap
metadata:
  name: {{- include "cert-manager-observability.name" . | indent 1 }}-definition
  namespace: {{- include "cert-manager-observability.namespace" . | indent 1 }}
  labels:
    {{- include "cert-manager-observability.labels" . | nindent 4 }}
data:
  json: |-
        {
        "annotations": {
            "list": [
            {
                "builtIn": 1,
                "datasource": {
                "type": "grafana",
                "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "target": {
                "limit": 100,
                "matchAny": false,
                "tags": [],
                "type": "dashboard"
                },
                "type": "dashboard"
            }
            ]
        },
        "description": "The dashboard gives an overview of the SSL certs managed by cert-manager in Kubernetes",
        "editable": true,
        "fiscalYearStartMonth": 0,
        "gnetId": 20842,
        "graphTooltip": 0,
        "id": 342,
        "links": [],
        "liveNow": false,
        "panels": [
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "The number if available certificates",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "thresholds"
                },
                "mappings": [],
                "noValue": "0",
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "green",
                        "value": null
                    }
                    ]
                }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 0,
                "y": 0
            },
            "id": 1,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "percentChangeColorMode": "standard",
                "reduceOptions": {
                "calcs": [
                    "lastNotNull"
                ],
                "fields": "",
                "values": false
                },
                "showPercentChange": false,
                "textMode": "value",
                "wideLayout": true
            },
            "pluginVersion": "11.2.0",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "disableTextWrap": false,
                "editorMode": "code",
                "exemplar": false,
                "expr": "count(certmanager_certificate_ready_status{condition=\"True\", cluster=~\"$cluster\", exported_namespace=~\"$namespace\"})",
                "fullMetaSearch": false,
                "includeNullMetadata": true,
                "instant": true,
                "interval": "",
                "legendFormat": "__auto",
                "range": false,
                "refId": "A",
                "useBackend": false
                }
            ],
            "title": "Valid Certificates",
            "type": "stat"
            },
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "The number of certificates that will expire within the next 14 days",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "thresholds"
                },
                "mappings": [],
                "noValue": "0",
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "green",
                        "value": null
                    },
                    {
                        "color": "#EAB839",
                        "value": 1
                    }
                    ]
                }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 8,
                "y": 0
            },
            "id": 3,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "percentChangeColorMode": "standard",
                "reduceOptions": {
                "calcs": [
                    "lastNotNull"
                ],
                "fields": "",
                "values": false
                },
                "showPercentChange": false,
                "textMode": "auto",
                "wideLayout": true
            },
            "pluginVersion": "11.2.0",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "disableTextWrap": false,
                "editorMode": "code",
                "exemplar": false,
                "expr": "count(certmanager_certificate_expiration_timestamp_seconds{cluster=~\"$cluster\", exported_namespace=~\"$namespace\"} < (time()+(14*24*3600)))",
                "fullMetaSearch": false,
                "includeNullMetadata": true,
                "instant": true,
                "interval": "",
                "legendFormat": "{{` {{exported_namespace}} `}}/{{` {{name}} `}}",
                "range": false,
                "refId": "A",
                "useBackend": false
                }
            ],
            "title": "Expiring Certificates",
            "type": "stat"
            },
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Total number of HTTP requests, based on the selected time range",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "thresholds"
                },
                "decimals": 0,
                "mappings": [],
                "noValue": "0",
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "text",
                        "value": null
                    }
                    ]
                }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 8,
                "x": 16,
                "y": 0
            },
            "id": 2,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "percentChangeColorMode": "standard",
                "reduceOptions": {
                "calcs": [
                    "lastNotNull"
                ],
                "fields": "",
                "values": false
                },
                "showPercentChange": false,
                "textMode": "auto",
                "wideLayout": true
            },
            "pluginVersion": "11.2.0",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "disableTextWrap": false,
                "editorMode": "code",
                "exemplar": false,
                "expr": "sum(increase(certmanager_http_acme_client_request_count{cluster=~\"$cluster\"}[$__range]))",
                "fullMetaSearch": false,
                "includeNullMetadata": true,
                "instant": true,
                "interval": "",
                "legendFormat": "__auto",
                "range": false,
                "refId": "A",
                "useBackend": false
                }
            ],
            "title": "Total ACME Requests",
            "type": "stat"
            },
            {
            "datasource": {
                "default": false,
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Time before the certificates expire. Only shows certificates expiring within 45 days",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "thresholds"
                },
                "mappings": [],
                "min": 0,
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "red",
                        "value": null
                    },
                    {
                        "color": "orange",
                        "value": 14
                    },
                    {
                        "color": "green",
                        "value": 30
                    },
                    {
                        "color": "dark-green",
                        "value": 60
                    }
                    ]
                },
                "unit": "s"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 10,
                "w": 12,
                "x": 0,
                "y": 8
            },
            "id": 5,
            "options": {
                "displayMode": "gradient",
                "maxVizHeight": 300,
                "minVizHeight": 16,
                "minVizWidth": 8,
                "namePlacement": "left",
                "orientation": "horizontal",
                "reduceOptions": {
                "calcs": [
                    "lastNotNull"
                ],
                "fields": "",
                "values": false
                },
                "showUnfilled": true,
                "sizing": "auto",
                "valueMode": "color"
            },
            "pluginVersion": "11.2.0",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "editorMode": "code",
                "exemplar": false,
                "expr": "sort(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$namespace\"} - time()) < 45 * (24*3600)",
                "format": "time_series",
                "instant": true,
                "interval": "",
                "legendFormat": "{{` {{cluster}} `}} - {{` {{exported_namespace}} `}} - {{` {{name}} `}}",
                "range": false,
                "refId": "A"
                }
            ],
            "title": "Time to Expiration (<45 days)",
            "type": "bargauge"
            },
            {
            "datasource": {
                "default": false,
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Time before the certificates are automatically renewed",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "thresholds"
                },
                "mappings": [],
                "min": 0,
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "green",
                        "value": null
                    }
                    ]
                },
                "unit": "s"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 10,
                "w": 12,
                "x": 12,
                "y": 8
            },
            "id": 6,
            "options": {
                "displayMode": "gradient",
                "maxVizHeight": 300,
                "minVizHeight": 16,
                "minVizWidth": 8,
                "namePlacement": "left",
                "orientation": "horizontal",
                "reduceOptions": {
                "calcs": [
                    "lastNotNull"
                ],
                "fields": "",
                "values": false
                },
                "showUnfilled": true,
                "sizing": "auto",
                "valueMode": "color"
            },
            "pluginVersion": "11.2.0",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "editorMode": "code",
                "exemplar": false,
                "expr": "sort(certmanager_certificate_renewal_timestamp_seconds{exported_namespace=~\"$namespace\"} - time()) < 45 * (24*3600)",
                "format": "time_series",
                "instant": true,
                "interval": "",
                "legendFormat": "{{` {{cluster}} `}} - {{` {{exported_namespace}} `}} - {{` {{name}} `}}",
                "range": false,
                "refId": "A"
                }
            ],
            "title": "Time to Automatic Renewal (<45 days)",
            "type": "bargauge"
            },
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Time before the certificates expire",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "palette-classic"
                },
                "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "line",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                    "legend": false,
                    "tooltip": false,
                    "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                    "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                    "group": "A",
                    "mode": "none"
                    },
                    "thresholdsStyle": {
                    "mode": "off"
                    }
                },
                "mappings": [],
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "green",
                        "value": null
                    }
                    ]
                },
                "unit": "d"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 9,
                "w": 24,
                "x": 0,
                "y": 18
            },
            "id": 4,
            "options": {
                "legend": {
                "calcs": [],
                "displayMode": "list",
                "placement": "right",
                "showLegend": true
                },
                "tooltip": {
                "mode": "single",
                "sort": "none"
                }
            },
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "editorMode": "code",
                "exemplar": true,
                "expr": "(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$namespace\"} - time())/(24*3600)",
                "instant": false,
                "interval": "",
                "legendFormat": "{{` {{cluster}} `}} - {{` {{exported_namespace}} `}} - {{` {{name}} `}}",
                "range": true,
                "refId": "A"
                }
            ],
            "title": "Time to Expiration",
            "type": "timeseries"
            },
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Displays the timestamp of a renewal, based on the expiration time changing",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "palette-classic"
                },
                "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "",
                    "axisPlacement": "auto",
                    "barAlignment": 0,
                    "barWidthFactor": 0.6,
                    "drawStyle": "bars",
                    "fillOpacity": 0,
                    "gradientMode": "none",
                    "hideFrom": {
                    "legend": false,
                    "tooltip": false,
                    "viz": false
                    },
                    "insertNulls": false,
                    "lineInterpolation": "linear",
                    "lineWidth": 1,
                    "pointSize": 5,
                    "scaleDistribution": {
                    "type": "linear"
                    },
                    "showPoints": "auto",
                    "spanNulls": false,
                    "stacking": {
                    "group": "A",
                    "mode": "normal"
                    },
                    "thresholdsStyle": {
                    "mode": "off"
                    }
                },
                "decimals": 1,
                "mappings": [],
                "min": 0,
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "green",
                        "value": null
                    }
                    ]
                },
                "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 9,
                "w": 24,
                "x": 0,
                "y": 27
            },
            "id": 8,
            "options": {
                "legend": {
                "calcs": [],
                "displayMode": "list",
                "placement": "right",
                "showLegend": true
                },
                "tooltip": {
                "mode": "single",
                "sort": "none"
                }
            },
            "pluginVersion": "8.3.2",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "editorMode": "code",
                "exemplar": true,
                "expr": "changes(certmanager_certificate_renewal_timestamp_seconds{cluster=~\"$cluster\", exported_namespace=~\"$namespace\"}[15m]) > 0",
                "format": "time_series",
                "instant": false,
                "interval": "",
                "legendFormat": "{{` {{cluster}} `}} - {{` {{exported_namespace}} `}} - {{` {{name}} `}}",
                "range": false,
                "refId": "A"
                }
            ],
            "title": "Certificate Renewal Events",
            "type": "timeseries"
            },
            {
            "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
            },
            "description": "Total number of HTTP requests, based on the selected range",
            "fieldConfig": {
                "defaults": {
                "color": {
                    "mode": "palette-classic"
                },
                "custom": {
                    "axisBorderShow": false,
                    "axisCenteredZero": false,
                    "axisColorMode": "text",
                    "axisLabel": "",
                    "axisPlacement": "auto",
                    "axisSoftMin": 0,
                    "fillOpacity": 80,
                    "gradientMode": "none",
                    "hideFrom": {
                    "legend": false,
                    "tooltip": false,
                    "viz": false
                    },
                    "lineWidth": 1,
                    "scaleDistribution": {
                    "type": "linear"
                    },
                    "thresholdsStyle": {
                    "mode": "off"
                    }
                },
                "mappings": [],
                "noValue": "0",
                "thresholds": {
                    "mode": "absolute",
                    "steps": [
                    {
                        "color": "text",
                        "value": null
                    }
                    ]
                }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 10,
                "w": 24,
                "x": 0,
                "y": 36
            },
            "id": 10,
            "options": {
                "barRadius": 0,
                "barWidth": 0.97,
                "fullHighlight": false,
                "groupWidth": 0.7,
                "legend": {
                "calcs": [],
                "displayMode": "list",
                "placement": "bottom",
                "showLegend": true
                },
                "orientation": "auto",
                "showValue": "auto",
                "stacking": "none",
                "tooltip": {
                "mode": "single",
                "sort": "none"
                },
                "xTickLabelRotation": -30,
                "xTickLabelSpacing": 0
            },
            "pluginVersion": "8.3.2",
            "targets": [
                {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "disableTextWrap": false,
                "editorMode": "code",
                "exemplar": false,
                "expr": "sort_desc(sum by (cluster)(increase(certmanager_http_acme_client_request_count{cluster=~\"$cluster\"}[$__range]))) > 0",
                "format": "table",
                "fullMetaSearch": false,
                "includeNullMetadata": true,
                "instant": true,
                "interval": "",
                "legendFormat": "{{` {{cluster}} `}}",
                "range": false,
                "refId": "A",
                "useBackend": false
                }
            ],
            "title": "ACME Requests by Cluster",
            "type": "barchart"
            }
        ],
        "schemaVersion": 39,
        "tags": [
            "k8s",
            "cert-manager"
        ],
        "templating": {
            "list": [
            {
                "current": {
                "selected": false,
                "text": "default",
                "value": "default"
                },
                "hide": 0,
                "includeAll": false,
                "multi": false,
                "name": "datasource",
                "options": [],
                "query": "prometheus",
                "queryValue": "",
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "type": "datasource"
            },
            {
                "current": {
                "selected": false,
                "text": "All",
                "value": "$__all"
                },
                "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
                },
                "definition": "label_values(certmanager_clock_time_seconds, cluster)",
                "hide": 0,
                "includeAll": true,
                "multi": false,
                "name": "cluster",
                "options": [],
                "query": {
                "query": "label_values(certmanager_clock_time_seconds, cluster)",
                "refId": "StandardVariableQuery"
                },
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "type": "query"
            },
            {
                "allValue": ".*",
                "current": {
                "selected": false,
                "text": "All",
                "value": "$__all"
                },
                "datasource": {
                "type": "prometheus",
                "uid": "${datasource}"
                },
                "definition": "label_values(certmanager_certificate_ready_status{cluster=~\"$cluster\"},exported_namespace)",
                "hide": 0,
                "includeAll": true,
                "multi": false,
                "name": "namespace",
                "options": [],
                "query": {
                "query": "label_values(certmanager_certificate_ready_status{cluster=~\"$cluster\"},exported_namespace)",
                "refId": "StandardVariableQuery"
                },
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "type": "query"
            }
            ]
        },
        "time": {
            "from": "now-24h",
            "to": "now"
        },
        "timepicker": {},
        "timezone": "browser",
        "title": "Cert-manager-Kubernetes",
        "uid": "cdhrcds8aosg0c",
        "version": 2,
        "weekStart": ""
        }